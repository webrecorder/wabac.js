{"version":3,"file":"notfound.js","sourceRoot":"","sources":["../src/notfound.ts"],"names":[],"mappings":"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","sourcesContent":["import { getCSP, getStatusText } from \"./utils\";\n\nexport function notFound(request: Request, msg?: string, status = 404) {\n  return notFoundByTypeResponse(request, request.url, \"\", false, status, msg);\n}\n\nexport function notFoundByTypeResponse(\n  request: Request,\n  requestURL: string,\n  requestTS: string,\n  liveRedirectOnNotFound = false,\n  status = 404,\n  msg?: string,\n) {\n  let content: string;\n  let contentType: string;\n\n  switch (request.destination as string) {\n    case \"json\":\n    case \"\":\n      content = getJSONNotFound(requestURL, requestTS, msg);\n      contentType = \"application/json; charset=utf-8\";\n      break;\n\n    case \"script\":\n      content = getScriptCSSNotFound(\"Script\", requestURL, requestTS, msg);\n      contentType = \"text/javascript; charset=utf-8\";\n      break;\n\n    case \"style\":\n      content = getScriptCSSNotFound(\"CSS\", requestURL, requestTS, msg);\n      contentType = \"text/css; charset=utf-8\";\n      break;\n\n    case \"document\":\n    case \"embed\":\n    case \"iframe\":\n    case \"frame\":\n    default:\n      content = getHTMLNotFound(\n        request,\n        requestURL,\n        requestTS,\n        liveRedirectOnNotFound,\n        msg,\n      );\n      contentType = \"text/html; charset=utf-8\";\n  }\n\n  return textToResponse(content, contentType, status);\n}\n\nfunction textToResponse(content: string, contentType: string, status = 200) {\n  const buff = new TextEncoder().encode(content);\n\n  const initOpt = {\n    status: status,\n    statusText: getStatusText(status),\n    headers: {\n      \"Content-Type\": contentType,\n      \"Content-Length\": buff.length + \"\",\n      \"Content-Security-Policy\": getCSP(),\n    },\n  };\n\n  return new Response(buff, initOpt);\n}\n\nfunction getHTMLNotFound(\n  request: Request,\n  requestURL: string,\n  requestTS: string,\n  liveRedirectOnNotFound: boolean,\n  msg?: string,\n) {\n  return `\n  <!doctype html>\n  <html>\n  <head>\n  <script>\n  window.requestURL = \"${requestURL}\";\n  </script>\n  </head>\n  <body style=\"font-family: sans-serif\">\n  <h2>Archived Page Not Found</h2>\n  <p>${msg || \"Sorry, this page was not found in this archive:\"}</p>\n  <p><code id=\"url\" style=\"word-break: break-all; font-size: larger\"></code></p>\n  ${\n    liveRedirectOnNotFound && request.mode === \"navigate\"\n      ? `\n  <p>Redirecting to live page now... (If this URL is a file download, the download should have started).</p>\n  <script>\n  window.top.location.href = window.requestURL;\n  </script>\n  `\n      : `\n  `\n  }\n  <p id=\"goback\" style=\"display: none\"><a href=\"#\" onclick=\"window.history.back()\">Go Back</a> to the previous page.</a></p>\n  \n  <p>\n  <a id=\"livelink\" target=\"_blank\" href=\"\">Load the live page</a> in a new tab (or download the file, if this URL points to a file).\n  </p>\n\n  <script>\n  document.querySelector(\"#url\").innerText = window.requestURL;\n  document.querySelector(\"#livelink\").href = window.requestURL;\n  let isTop = true;\n  try {\n    if (window.parent._WB_wombat_location) {\n      isTop = false;\n    }\n  } catch (e) {\n\n  }\n  if (isTop) {\n    document.querySelector(\"#goback\").style.display = \"\";\n\n    window.parent.postMessage({\n      wb_type: \"archive-not-found\",\n      url: window.requestURL,\n      ts: \"${requestTS}\"\n    }, \"*\");\n  }\n  </script>\n  </body>\n  </html>\n  `;\n}\n\nfunction getScriptCSSNotFound(\n  type: string,\n  requestURL: string,\n  requestTS: string,\n  msg?: string,\n) {\n  return `\\\n/* \n   ${msg ? msg : type + \" Not Found\"}\n   URL: ${requestURL}\n   TS: ${requestTS}\n*/\n  `;\n}\n\nfunction getJSONNotFound(URL: string, TS: string, error = \"not_found\") {\n  return JSON.stringify({ error, URL, TS });\n}\n\nexport function getProxyNotFoundResponse(url: string, status: number) {\n  return textToResponse(getHTMLNotProxyError(url, status), \"text/html\", status);\n}\n\nfunction getHTMLNotProxyError(requestURL: string, status: number) {\n  return `\n  <!doctype html>\n  <html>\n  <head>\n  <script>\n  window.requestURL = \"${requestURL}\";\n  </script>\n  </head>\n  <body style=\"font-family: sans-serif\">\n  <h2>Live page could not be loaded</h2>\n  <p>Sorry, this page was could not be loaded through the archiving proxy. Check the URL and try again.</p>\n  <p><code id=\"url\" style=\"word-break: break-all; font-size: larger\">Status Code: ${status}</code></p>\n  <p id=\"goback\" style=\"display: none\"><a href=\"#\" onclick=\"window.history.back()\">Go Back</a> to the previous page.</a></p>\n\n  <script>\n  let isTop = true;\n  try {\n    if (window.parent._WB_wombat_location) {\n      isTop = false;\n    }\n  } catch (e) {\n\n  }\n  if (isTop) {\n    document.querySelector(\"#goback\").style.display = \"\";\n\n    window.parent.postMessage({\n      wb_type: \"live-proxy-url-error\",\n      url: window.requestURL,\n      status: ${status},\n    }, \"*\");\n  }\n  </script>\n  </body>\n  </html>\n  `;\n}\n"]}