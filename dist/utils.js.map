{"version":3,"file":"utils.js","sourceRoot":"","sources":["../src/utils.ts"],"names":[],"mappings":"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","sourcesContent":["declare let self: ServiceWorkerGlobalScope;\n\nimport { getReasonPhrase } from \"http-status-codes\";\nimport { type ArchiveRequest } from \"./request\";\n\n// Threshold size for switching to range requests\nexport const MAX_FULL_DOWNLOAD_SIZE = 25000000;\n\nexport const PAGE_STATE_NOT_FINISHED = 0x00;\nexport const PAGE_STATE_NEED_REMOTE_SYNC = 0x10;\nexport const PAGE_STATE_NEED_LOCAL_SYNC = 0x01;\nexport const PAGE_STATE_SYNCED = 0x11;\n\nexport const INITIAL_STREAM_CHUNK_SIZE = 512;\nexport const MAX_STREAM_CHUNK_SIZE = 65536 * 4;\n\nexport const REPLAY_TOP_FRAME_NAME = \"___wb_replay_top_frame\";\n\nexport const REMOVE_EXPIRES = /Expires=\\w{3},\\s\\d[^;,]+(?:;\\s*)?/gi;\n\nexport const DEFAULT_CSP =\n  \"default-src 'unsafe-eval' 'unsafe-inline' 'self' data: blob: mediastream: ws: wss: ; form-action 'self' ; object-src 'none'\";\n\nlet fullCSP = DEFAULT_CSP;\n\nexport function updateCSP(replayPrefix: string) {\n  fullCSP += `; frame-src data: about: blob: ${self.location.origin}${self.location.pathname} ${replayPrefix}`;\n}\n\nexport function getCSP() {\n  return fullCSP;\n}\n\nexport function startsWithAny(value: string, iter: Iterable<string>) {\n  for (const str of iter) {\n    if (value.startsWith(str)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nexport function containsAny(value: string, iter: Iterable<string>) {\n  for (const str of iter) {\n    if (value.indexOf(str) >= 0) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nexport function getTS(iso: string) {\n  return iso.replace(/[-:T]/g, \"\").slice(0, 14);\n}\n\nexport function getTSMillis(iso: string) {\n  return iso.replace(/[-:.TZ]/g, \"\");\n}\n\nexport function tsToDate(ts: string) {\n  if (!ts) {\n    return new Date();\n  }\n\n  if (ts.length < 17) {\n    ts += \"00000101000000000\".substring(ts.length);\n  }\n\n  const datestr =\n    ts.substring(0, 4) +\n    \"-\" +\n    ts.substring(4, 6) +\n    \"-\" +\n    ts.substring(6, 8) +\n    \"T\" +\n    ts.substring(8, 10) +\n    \":\" +\n    ts.substring(10, 12) +\n    \":\" +\n    ts.substring(12, 14) +\n    \".\" +\n    ts.substring(14) +\n    \"Z\";\n\n  return new Date(datestr);\n}\n\nexport function tsToSec(ts: string) {\n  return tsToDate(ts).getTime() / 1000;\n}\n\nexport function getSecondsStr(date: Date) {\n  // [TODO]\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n  if (!date) {\n    return \"\";\n  }\n\n  try {\n    return \"\" + date.getTime() / 1000;\n    // [TODO]\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  } catch (e) {\n    return \"\";\n  }\n}\n\nexport function base16(hashBuffer: ArrayBuffer) {\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\n  return hashArray.map((b) => b.toString(16).padStart(2, \"0\")).join(\"\");\n}\n\nexport async function digestMessage(\n  message: string | Uint8Array,\n  hashtype: string,\n  prefix: string | null = null,\n) {\n  const msgUint8 =\n    typeof message === \"string\" ? new TextEncoder().encode(message) : message;\n  const hashBuffer = await crypto.subtle.digest(hashtype, msgUint8);\n  if (prefix === \"\") {\n    return base16(hashBuffer);\n  }\n  return (prefix || hashtype) + \":\" + base16(hashBuffer);\n}\n\nexport function decodeLatin1(buf: Uint8Array) {\n  let str = \"\";\n  // [TODO]\n  // eslint-disable-next-line @typescript-eslint/prefer-for-of\n  for (let i = 0; i < buf.length; i++) {\n    // @ts-expect-error [TODO] - TS2345 - Argument of type 'number | undefined' is not assignable to parameter of type 'number'.\n    str += String.fromCharCode(buf[i]);\n  }\n  return str;\n}\n\nexport function encodeLatin1(str: string) {\n  const buf = new Uint8Array(str.length);\n  for (let i = 0; i < str.length; i++) {\n    buf[i] = str.charCodeAt(i) & 0xff;\n  }\n  return buf;\n}\n\n//from http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript\nexport function randomId() {\n  return (\n    Math.random().toString(36).substring(2, 15) +\n    Math.random().toString(36).substring(2, 15)\n  );\n}\n\nexport function makeHeaders(\n  headers: Headers | Record<string, string> | Map<string, string>,\n) {\n  try {\n    return new Headers(headers as Headers);\n    // [TODO]\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  } catch (e) {\n    // try to sanitize the headers, if any errors\n    if (typeof headers === \"object\") {\n      const headersObj = headers as Record<string, string>;\n      for (const key of Object.keys(headers)) {\n        const value = headersObj[key];\n        // @ts-expect-error [TODO] - TS2532 - Object is possibly 'undefined'.\n        const newValue = value.replace(/[\\r\\n]+/g, \", \");\n        if (value != newValue) {\n          headersObj[key] = newValue;\n        }\n      }\n    } else {\n      const headersMap = headers as Map<string, string>;\n      for (const key of Object.keys(headers)) {\n        const value = headersMap.get(key) || \"\";\n        const newValue = value.replace(/[\\r\\n]+/g, \", \");\n        if (value != newValue) {\n          headersMap.set(key, newValue);\n        }\n      }\n    }\n    return new Headers(headers as Headers);\n  }\n}\n\nexport function parseSetCookie(setCookie: string, scheme: string) {\n  setCookie = setCookie.replace(REMOVE_EXPIRES, \"\");\n  const cookies: string[] = [];\n\n  for (const cookie of setCookie.split(\",\")) {\n    const cookieCore = cookie.split(\";\", 1)[0];\n    // if has cookie flags\n    if (cookieCore !== cookie) {\n      // @ts-expect-error [TODO] - TS2532 - Object is possibly 'undefined'.\n      const cookieRemainder = cookie.slice(cookieCore.length).toLowerCase();\n      if (cookieRemainder.indexOf(\"httponly\") > 0) {\n        continue;\n      }\n      if (scheme === \"http\" && cookieRemainder.indexOf(\"secure\") > 0) {\n        continue;\n      }\n    }\n\n    // @ts-expect-error [TODO] - TS2345 - Argument of type 'string | undefined' is not assignable to parameter of type 'string'.\n    cookies.push(cookieCore);\n  }\n\n  return cookies.join(\";\");\n}\n\nconst NULL_STATUS = [101, 204, 205, 304];\n\nexport function isNullBodyStatus(status: number) {\n  return NULL_STATUS.includes(status);\n}\n\nexport function getStatusText(status: number) {\n  try {\n    return getReasonPhrase(status);\n    // [TODO]\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  } catch (e) {\n    return \"Unknown Status\";\n  }\n}\n\nexport function isAjaxRequest(request: ArchiveRequest | Request) {\n  if (request.headers.get(\"X-Pywb-Requested-With\") === \"XMLHttpRequest\") {\n    return true;\n  }\n\n  if (request.mode === \"cors\") {\n    // if 'mod' is esm_, then likely a module import\n    // [TODO]\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    if (request.destination === \"script\" && (request as any).mod === \"esm_\") {\n      return false;\n    }\n    return true;\n  }\n\n  return false;\n}\n\n// [TODO]\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport async function handleAuthNeeded(e: any, config: any) {\n  if (e instanceof AuthNeededError) {\n    //const client = await self.clients.get(event.clientId || event.resultingClientId);\n    const clients = await self.clients.matchAll({ type: \"window\" });\n    for (const client of clients) {\n      const url = new URL(client.url);\n      if (url.searchParams.get(\"source\") === config.sourceUrl) {\n        client.postMessage({\n          source: config.sourceUrl,\n          coll: config.dbname.slice(3),\n          type: \"authneeded\",\n          // @ts-expect-error [TODO] - TS4111 - Property 'fileHandle' comes from an index signature, so it must be accessed with ['fileHandle'].\n          fileHandle: e.info.fileHandle,\n        });\n      }\n    }\n    return true;\n  }\n\n  return false;\n}\n\n// [TODO]\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function getCollData(coll: any) {\n  const metadata = coll.config.metadata ? coll.config.metadata : {};\n\n  const res = {\n    ...metadata,\n    title: metadata.title || \"\",\n    desc: metadata.desc || \"\",\n    size: metadata.size || 0,\n    filename: coll.config.sourceName,\n    loadUrl: coll.config.loadUrl,\n    sourceUrl: coll.config.sourceUrl,\n    id: coll.name,\n    ctime: coll.config.ctime,\n    mtime: metadata.mtime || coll.config.ctime,\n    onDemand: coll.config.onDemand,\n  };\n\n  if (metadata.ipfsPins) {\n    res.ipfsPins = metadata.ipfsPins;\n  }\n\n  // [TODO]\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n  return res;\n}\n\n// ===========================================================================\nexport class RangeError {\n  // [TODO]\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  info: Record<string, any>;\n\n  constructor(info = {}) {\n    this.info = info;\n  }\n\n  toString() {\n    return JSON.stringify(this.info);\n  }\n}\n\nexport class AuthNeededError extends RangeError {}\n\nexport class AccessDeniedError extends RangeError {}\n\nexport class Canceled {}\n\nexport class DeleteExpiredError {}\n\nexport async function sleep(millis: number) {\n  return new Promise((resolve) => setTimeout(resolve, millis));\n}\n\nexport const proxyAllowPaths = new Set<string>();\n\nexport function addProxyAllowPaths(paths: string[]) {\n  for (const path of paths) {\n    try {\n      const absPath = new URL(path, self.location.href);\n      proxyAllowPaths.add(absPath.href);\n    } catch (_) {\n      // ignore\n    }\n  }\n}\n"]}