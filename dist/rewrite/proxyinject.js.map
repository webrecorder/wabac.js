{"version":3,"file":"proxyinject.js","sourceRoot":"","sources":["../../src/rewrite/proxyinject.ts"],"names":[],"mappings":"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","sourcesContent":["type WbInfo = {\n  prefix: string;\n  proxyOrigin: string;\n  localOrigin: string;\n  proxyTLD?: string;\n  localTLD?: string;\n  presetCookie?: string;\n  seconds: string;\n};\n\n// Mini Wombat for proxy replay, includes:\n// - window.open override for rewriting links to subdomain\n// - dom override for rewriting A links to subdomains, IFRAME src to direct replay mode\n\nclass ProxyWombatRewrite {\n  proxyOrigin: string;\n  localOrigin: string;\n\n  proxyTLD?: string;\n  localTLD?: string;\n\n  localScheme: string;\n  proxyScheme: string;\n  httpToHttpsNeeded: boolean;\n\n  prefix: string;\n  relPrefix = \"\";\n  schemeRelPrefix = \"\";\n\n  constructor() {\n    this.openOverride();\n    this.domOverride();\n    this.overrideInsertAdjacentHTML();\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const wbinfo = (self as any).__wbinfo as WbInfo;\n\n    this.initDateOverride(wbinfo.seconds);\n    this.initAnchorElemOverride();\n\n    this.proxyOrigin = wbinfo.proxyOrigin;\n    this.localOrigin = wbinfo.localOrigin;\n\n    this.proxyTLD = wbinfo.proxyTLD;\n    this.localTLD = wbinfo.localTLD;\n\n    this.localScheme = new URL(this.localOrigin).protocol;\n    this.proxyScheme = new URL(this.proxyOrigin).protocol;\n\n    this.httpToHttpsNeeded =\n      this.proxyScheme === \"http:\" && this.localScheme === \"https:\";\n\n    this.prefix = wbinfo.prefix || \"\";\n    if (this.prefix) {\n      const parsed = new URL(this.prefix);\n      this.relPrefix = parsed.pathname;\n      this.schemeRelPrefix = this.prefix.slice(parsed.protocol.length);\n    }\n\n    if (wbinfo.presetCookie) {\n      this.initPresetCookie(wbinfo.presetCookie);\n    }\n  }\n\n  initPresetCookie(presetCookie: string) {\n    const splitCookies = presetCookie.split(\";\");\n    for (const cookie of splitCookies) {\n      document.cookie = cookie.trim();\n    }\n  }\n\n  recurseRewriteElem(curr: Element) {\n    if (!curr.hasChildNodes()) return;\n    const rewriteQ = [curr.childNodes];\n\n    while (rewriteQ.length > 0) {\n      const children = rewriteQ.shift();\n      for (const child of children || []) {\n        if (child.nodeType === Node.ELEMENT_NODE) {\n          const childElem = child as Element;\n          this.rewriteElem(childElem);\n          if (curr.hasChildNodes()) {\n            rewriteQ.push(childElem.childNodes);\n          }\n        }\n      }\n    }\n  }\n\n  rewriteElem(curr: Element) {\n    switch (curr.tagName) {\n      case \"IFRAME\":\n        {\n          const value = curr.getAttribute(\"src\");\n          if (value) {\n            const newValue = this.fullRewriteUrl(value);\n            if (value !== newValue) {\n              curr.setAttribute(\"src\", newValue);\n            }\n          }\n        }\n        break;\n\n      case \"A\":\n        {\n          const value = curr.getAttribute(\"href\");\n          if (value) {\n            const newValue = this.rewriteUrl(value);\n            if (value !== newValue) {\n              curr.setAttribute(\"href\", newValue);\n            }\n          }\n        }\n        break;\n\n      case \"SCRIPT\":\n        if (this.httpToHttpsNeeded) {\n          const value = curr.getAttribute(\"src\");\n          if (value) {\n            const newValue = this.rewriteUrl(value);\n            if (value !== newValue) {\n              curr.setAttribute(\"src\", newValue);\n            }\n          }\n        }\n        break;\n    }\n  }\n\n  domOverride() {\n    const rwNode = (node: Node) => {\n      switch (node.nodeType) {\n        case Node.ELEMENT_NODE:\n          this.rewriteElem(node as Element);\n          break;\n\n        case Node.DOCUMENT_FRAGMENT_NODE:\n          this.recurseRewriteElem(node as Element);\n          break;\n      }\n    };\n\n    const rewriteFunc = (\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      fnThis: any,\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      originalFn: any,\n      newNode: Node,\n      oldNode?: Node,\n    ) => {\n      rwNode(newNode);\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n      return originalFn.call(fnThis, newNode, oldNode);\n    };\n\n    const rewriteArrayFunc = (\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      fnThis: any,\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      originalFn: any,\n      newNodes: Node[],\n    ) => {\n      for (const node of newNodes) {\n        rwNode(node);\n      }\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n      return originalFn.call(fnThis, ...newNodes);\n    };\n\n    const orig_appendChild = Node.prototype.appendChild;\n    Node.prototype.appendChild = function (newNode: Node) {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n      return rewriteFunc(this, orig_appendChild, newNode);\n    };\n\n    const orig_insertBefore = Node.prototype.insertBefore;\n    Node.prototype.insertBefore = function (newNode: Node, refNode: Node) {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n      return rewriteFunc(this, orig_insertBefore, newNode, refNode);\n    };\n\n    const orig_replaceChild = Node.prototype.replaceChild;\n    Node.prototype.replaceChild = function (newNode: Node, oldNode: Node) {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n      return rewriteFunc(this, orig_replaceChild, newNode, oldNode);\n    };\n\n    const orig_append = DocumentFragment.prototype.append;\n    DocumentFragment.prototype.append = function (...newNodes: Node[]) {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n      return rewriteArrayFunc(this, orig_append, newNodes);\n    };\n\n    const orig_prepend = DocumentFragment.prototype.prepend;\n    DocumentFragment.prototype.prepend = function (...newNodes: Node[]) {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n      return rewriteArrayFunc(this, orig_prepend, newNodes);\n    };\n  }\n\n  openOverride() {\n    let orig = window.open;\n\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n    if (Window.prototype.open) {\n      orig = Window.prototype.open;\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const rewriter = this;\n\n    function openRW(\n      strUrl: string | URL | undefined,\n      strWindowName?: string,\n      strWindowFeatures?: string,\n    ): Window | null {\n      const rwStrUrl = strUrl ? rewriter.rewriteUrl(strUrl.toString()) : \"\";\n      const res = orig.call(\n        // @ts-ignore\n        this,\n        rwStrUrl,\n        strWindowName,\n        strWindowFeatures,\n      );\n      return res;\n    }\n\n    window.open = openRW;\n\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n    if (Window.prototype.open) {\n      Window.prototype.open = openRW;\n    }\n\n    // eslint-disable-next-line @typescript-eslint/prefer-for-of\n    for (let i = 0; i < window.frames.length; i++) {\n      try {\n        window.frames[i]!.open = openRW;\n      } catch (e) {\n        console.log(e);\n      }\n    }\n  }\n\n  overrideInsertAdjacentHTML() {\n    const orig = HTMLElement.prototype.insertAdjacentHTML;\n\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const rewriter = this;\n\n    HTMLElement.prototype.insertAdjacentHTML = function (position, text) {\n      text = rewriter.rewriteRxHtml(text);\n      return orig.call(this, position, text);\n    };\n  }\n\n  rewriteRxHtml(text: string) {\n    return text.replace(\n      /<\\s*(a|iframe)\\s+(?:src|href)[=]['\"](.*?)['\"]/gi,\n      (match: string, p1: string, p2: string) => {\n        let rw = \"\";\n        switch (p1) {\n          case \"a\":\n            rw = this.rewriteUrl(p2);\n            break;\n\n          case \"iframe\":\n            rw = this.fullRewriteUrl(p2);\n            break;\n        }\n        if (rw && rw !== match) {\n          return match.replace(p2, rw);\n        }\n        return match;\n      },\n    );\n  }\n\n  convUrl(\n    urlStr: string,\n    fromOrigin: string,\n    toOrigin: string,\n    fromTLD?: string,\n    toTLD?: string,\n    fromSep?: string,\n    toSep?: string,\n    toScheme?: string,\n    httpToHttpsNeeded = false,\n  ) {\n    if (fromOrigin && urlStr.startsWith(fromOrigin)) {\n      return toOrigin + urlStr.slice(fromOrigin.length);\n    }\n\n    if (fromTLD && toTLD && urlStr.indexOf(fromTLD) > 0) {\n      const url = new URL(urlStr);\n      if (url.host.endsWith(fromTLD)) {\n        let host = url.host.slice(0, -fromTLD.length);\n        if (fromSep && toSep) {\n          host = host.replace(fromSep, toSep);\n        }\n        const newUrl =\n          toScheme + \"//\" + host + toTLD + url.href.slice(url.origin.length);\n        return newUrl;\n      }\n    }\n\n    if (httpToHttpsNeeded) {\n      return urlStr.replace(\"http:\", \"https:\");\n    }\n\n    return urlStr;\n  }\n\n  rewriteUrl(urlStr: string) {\n    return this.convUrl(\n      urlStr,\n      this.proxyOrigin,\n      this.localOrigin,\n      this.proxyTLD,\n      this.localTLD,\n      \".\",\n      \"-\",\n      this.localScheme,\n      this.httpToHttpsNeeded,\n    );\n  }\n\n  unrewriteUrl(urlStr: string): string {\n    return this.convUrl(\n      urlStr,\n      this.localOrigin,\n      this.proxyOrigin,\n      this.localTLD,\n      this.proxyTLD,\n      \"-\",\n      \".\",\n      this.proxyScheme,\n    );\n  }\n\n  fullRewriteUrl(url: string, mod = \"if_\") {\n    const origUrl = url;\n\n    if (this.proxyOrigin && url.startsWith(this.proxyOrigin)) {\n      return this.localOrigin + url.slice(this.proxyOrigin.length);\n    }\n\n    url = url.trim();\n\n    if (\n      !url ||\n      !this.isRewritableUrl(url) ||\n      url.startsWith(this.prefix) ||\n      url.startsWith(this.relPrefix)\n    ) {\n      return origUrl;\n    }\n\n    if (\n      url.startsWith(\"http:\") ||\n      url.startsWith(\"https:\") ||\n      url.startsWith(\"https\\\\3a/\")\n    ) {\n      return this.prefix + mod + \"/\" + url;\n    }\n\n    if (url.startsWith(\"//\") || url.startsWith(\"\\\\/\\\\/\")) {\n      return this.schemeRelPrefix + mod + \"/\" + url;\n    }\n\n    return origUrl;\n  }\n\n  isRewritableUrl(url: string) {\n    const NO_REWRITE_URI_PREFIX = [\n      \"#\",\n      \"javascript:\",\n      \"data:\",\n      \"mailto:\",\n      \"about:\",\n      \"file:\",\n      \"blob:\",\n      \"{\",\n    ];\n\n    for (const prefix of NO_REWRITE_URI_PREFIX) {\n      if (url.startsWith(prefix)) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  initAnchorElemOverride() {\n    const origHref = Object.getOwnPropertyDescriptor(\n      HTMLAnchorElement.prototype,\n      \"href\",\n    );\n    if (!origHref?.get) {\n      return;\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const rw = this;\n\n    const origHrefGet = origHref.get;\n\n    const overrideProp = (\n      propName: \"href\" | \"hostname\" | \"host\" | \"protocol\" | \"origin\",\n    ) => {\n      const origProp = Object.getOwnPropertyDescriptor(\n        HTMLAnchorElement.prototype,\n        propName,\n      );\n      if (!origProp?.set) {\n        return;\n      }\n\n      const origPropSet = origProp.set;\n\n      Object.defineProperty(HTMLAnchorElement.prototype, propName, {\n        set(v: string) {\n          const url = new URL(rw.rewriteUrl(v));\n          return origPropSet.call(this, url[propName]);\n        },\n        get() {\n          const url = new URL(\n            rw.unrewriteUrl(origHrefGet.call(this) as string),\n          );\n          return url[propName];\n        },\n      });\n    };\n\n    overrideProp(\"href\");\n    overrideProp(\"hostname\");\n    overrideProp(\"host\");\n    overrideProp(\"protocol\");\n    overrideProp(\"origin\");\n  }\n\n  initDateOverride(timestamp: string) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    if ((self as any).__wb_Date_now) return;\n    const newTimestamp = parseInt(timestamp) * 1000;\n    // var timezone = new Date().getTimezoneOffset() * 60 * 1000;\n    // Already UTC!\n    const timezone = 0;\n    const start_now = Date.now();\n    const timediff = start_now - (newTimestamp - timezone);\n\n    const orig_date = Date;\n\n    const orig_utc = Date.UTC;\n    const orig_parse = Date.parse;\n    const orig_now = Date.now;\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (self as any).__wb_Date_now = orig_now;\n\n    // @ts-ignore old-style override\n    window.Date = (function (Date_) {\n      return function Date(\n        A?: number,\n        B?: number,\n        C?: number,\n        D?: number,\n        E?: number,\n        F?: number,\n        G?: number,\n      ) {\n        // Apply doesn't work for constructors and Date doesn't\n        // seem to like undefined args, so must explicitly\n        // call constructor for each possible args 0..7\n        if (A === undefined) {\n          return new Date_(orig_now() - timediff);\n        } else if (B === undefined) {\n          return new Date_(A);\n        } else if (C === undefined) {\n          return new Date_(A, B);\n        } else if (D === undefined) {\n          return new Date_(A, B, C);\n        } else if (E === undefined) {\n          return new Date_(A, B, C, D);\n        } else if (F === undefined) {\n          return new Date_(A, B, C, D, E);\n        } else if (G === undefined) {\n          return new Date_(A, B, C, D, E, F);\n        } else {\n          return new Date_(A, B, C, D, E, F, G);\n        }\n      };\n    })(Date);\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (Date as any).prototype = orig_date.prototype;\n\n    Date.now = function now() {\n      return orig_now() - timediff;\n    };\n\n    Date.UTC = orig_utc;\n    Date.parse = orig_parse;\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (Date as any).__WB_timediff = timediff;\n\n    Date.prototype.getTimezoneOffset = function () {\n      return 0;\n    };\n\n    const orig_toString = Date.prototype.toString;\n    Date.prototype.toString = function () {\n      const string = orig_toString.call(this).split(\" GMT\")[0];\n      return string + \" GMT+0000 (GMT)\";\n    };\n\n    const orig_toTimeString = Date.prototype.toTimeString;\n    Date.prototype.toTimeString = function () {\n      const string = orig_toTimeString.call(this).split(\" GMT\")[0];\n      return string + \" GMT+0000 (GMT)\";\n    };\n\n    Object.defineProperty(Date.prototype, \"constructor\", {\n      value: Date,\n    });\n  }\n}\n\nnew ProxyWombatRewrite();\n"]}